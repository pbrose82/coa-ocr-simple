<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alchemy OCR Intelligence</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-container">
            <i class="fas fa-file-alt header-logo"></i>
            <h1 class="header-title">Alchemy OCR Intelligence</h1>
        </div>
    </div>
    
    <!-- App Info Banner -->
    <div class="tenant-banner">
        <div class="tenant-container">
            <div class="tenant-info">
                Extract text and data from your documents with advanced OCR and AI
                <a href="/training" class="btn btn-sm btn-outline-primary ms-3">
                    <i class="fas fa-brain me-1"></i> Train AI Model
                </a>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- OCR Section -->
        <div class="ocr-section">
            <div class="form-group mb-4">
                <label class="form-label">Select Document Type</label>
                <select class="form-select" id="fileFormat">
                    <option value="pdf" selected>PDF Document</option>
                    <option value="image">Image (JPG, PNG, TIFF)</option>
                </select>
            </div>
            
            <div class="form-group mb-4">
                <label class="form-label">Upload Document</label>
                <div class="file-upload" id="dropZone">
                    <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p class="file-upload-text">Drag & drop your file here</p>
                    <p class="file-upload-hint">or</p>
                    <label for="fileInput" class="custom-file-upload">Choose File</label>
                    <input type="file" id="fileInput" name="file" accept=".jpg,.jpeg,.png,.pdf,.tiff" hidden>
                    <div id="fileName" class="file-info" style="display: none;">
                        <i class="fas fa-file-alt"></i>
                        <span id="fileNameText"></span>
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button id="extractButton" class="btn-extract disabled" disabled>EXTRACT DATA</button>
                <button id="sendToAlchemy" class="btn-submit" disabled>SUBMIT TO ALCHEMY</button>
                <button id="resetButton" class="btn-reset">RESET</button>
            </div>
            
            <!-- Processing Status -->
            <div id="processingStatus" style="display: none;" class="alert alert-info mt-3">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <span id="statusText">Processing document...</span>
                </div>
                <div class="progress mt-2">
                    <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Alchemy Record Link -->
            <div id="alchemyRecordLink" style="display: none;" class="alert alert-success mt-3">
                <p>Data successfully sent to Alchemy!</p>
                <p><a href="#" id="recordLink" target="_blank" class="alert-link">View record in Alchemy</a></p>
            </div>
            
            <!-- Results Box -->
            <div id="results" style="display: none;" class="result-box">
                <h5>Extracted Data</h5>
                <table class="table table-bordered result-table">
                    <tbody id="dataTable">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
                
                <div class="mt-4">
                    <h5>Raw Text</h5>
                    <div id="rawText" class="raw-text"></div>
                </div>
            </div>
        </div>
        
        <!-- Tips Section -->
        <div class="tips-section">
            <div class="tips-title">
                <i class="fas fa-lightbulb"></i>
                Tips for best results:
            </div>
            <ul class="tips-list">
                <li>Image files (JPG, PNG) process faster than PDFs</li>
                <li>PDFs with embedded text work best</li>
                <li>Use clear, high-resolution images of your documents</li>
                <li>You can drag and drop files directly onto the upload area</li>
            </ul>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <img src="{{ url_for('static', filename='Alchemy-logo.svg') }}" alt="Alchemy Cloud Logo" class="footer-logo">
            <div class="copyright">Â© ALCHEMY CLOUD, INC. ALL RIGHTS RESERVED.</div>
        </div>
    </div>
    
    <!-- JavaScript for file upload handling -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const fileNameDisplay = document.getElementById('fileName');
            const fileNameText = document.getElementById('fileNameText');
            const dropZone = document.getElementById('dropZone');
            const extractButton = document.getElementById('extractButton');
            const fileFormat = document.getElementById('fileFormat');
            const resetButton = document.getElementById('resetButton');
            
            // File input change handler
            fileInput.addEventListener('change', function() {
                handleFileSelection(this.files);
            });
            
            // File format change handler
            fileFormat.addEventListener('change', function() {
                if (fileFormat.value === 'image') {
                    fileInput.accept = ".jpg,.jpeg,.png,.tiff";
                } else {
                    fileInput.accept = ".pdf";
                }
            });
            
            // Reset button handler
            resetButton.addEventListener('click', function() {
                window.location.reload();
            });
            
            // Drag and drop handling
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.classList.add('highlight');
            }
            
            function unhighlight() {
                dropZone.classList.remove('highlight');
            }
            
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                handleFileSelection(files);
            }
            
            function handleFileSelection(files) {
                if (files.length > 0) {
                    const file = files[0];
                    
                    // Display file name
                    fileNameText.textContent = file.name;
                    fileNameDisplay.style.display = 'flex';
                    
                    // Enable extract button
                    extractButton.classList.remove('disabled');
                    extractButton.classList.add('active');
                    extractButton.disabled = false;
                    
                    // Add selected class to drop zone
                    dropZone.classList.add('file-selected');
                    
                    // Sync the file input
                    if (files !== fileInput.files) {
                        fileInput.files = files;
                    }
                }
            }
        });
    </script>
    
    <!-- Load main application script -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
